{
  "version": "2.0.0",
  "tasks": [
    // ────────── Build Tasks ──────────
    {
      "label": "Build All",
      "type": "shell",
      "command": "powershell.exe",
      "args": [
        "-ExecutionPolicy", "Bypass",
        "-File", "${workspaceFolder}\\scripts\\build.ps1"
      ],
      "group": {
        "kind": "build",
        "isDefault": true
      },
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": true,
        "clear": false
      },
      "problemMatcher": [
        "$msCompile",
        "$gcc"
      ],
      "detail": "Build both C++ DLL and Python environment"
    },
    {
      "label": "Build C++ DLL (Release)",
      "type": "shell",
      "command": "powershell.exe",
      "args": [
        "-ExecutionPolicy", "Bypass",
        "-File", "${workspaceFolder}\\scripts\\build-cpp.ps1",
        "-Configuration", "Release",
        "-Platform", "x64"
      ],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared"
      },
      "problemMatcher": "$msCompile",
      "detail": "Build C++ DLL in Release configuration"
    },
    {
      "label": "Build C++ DLL (Debug)",
      "type": "shell",
      "command": "powershell.exe",
      "args": [
        "-ExecutionPolicy", "Bypass",
        "-File", "${workspaceFolder}\\scripts\\build-cpp.ps1",
        "-Configuration", "Debug",
        "-Platform", "x64"
      ],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared"
      },
      "problemMatcher": "$msCompile",
      "detail": "Build C++ DLL in Debug configuration"
    },
    {
      "label": "Setup Python Environment",
      "type": "shell",
      "command": "powershell.exe",
      "args": [
        "-ExecutionPolicy", "Bypass",
        "-File", "${workspaceFolder}\\scripts\\build-python.ps1"
      ],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared"
      },
      "detail": "Setup Python virtual environment and install dependencies"
    },
    {
      "label": "Clean Build",
      "type": "shell",
      "command": "powershell.exe",
      "args": [
        "-ExecutionPolicy", "Bypass",
        "-File", "${workspaceFolder}\\scripts\\build.ps1",
        "-Clean"
      ],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared"
      },
      "detail": "Clean and rebuild everything"
    },

    // ────────── Run Tasks ──────────
    {
      "label": "Run Python Injector",
      "type": "shell",
      "command": "${workspaceFolder}\\.venv\\Scripts\\python.exe",
      "args": [
        "${workspaceFolder}\\injector\\inject.py"
      ],
      "group": "test",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "new"
      },
      "dependsOn": "Build All",
      "detail": "Run the DLL injection script (builds project first)"
    },
    {
      "label": "Run Python Injector (No Build)",
      "type": "shell",
      "command": "${workspaceFolder}\\.venv\\Scripts\\python.exe",
      "args": [
        "${workspaceFolder}\\injector\\inject.py"
      ],
      "group": "test",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "new"
      },
      "detail": "Run the DLL injection script without building"
    },

    // ────────── Utility Tasks ──────────
    {
      "label": "Install Python Dependencies",
      "type": "shell",
      "command": "${workspaceFolder}\\.venv\\Scripts\\pip.exe",
      "args": [
        "install", "-r", "${workspaceFolder}\\requirements.txt"
      ],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared"
      },
      "detail": "Install Python dependencies from requirements.txt"
    },
    {
      "label": "Format Python Code",
      "type": "shell",
      "command": "${workspaceFolder}\\.venv\\Scripts\\python.exe",
      "args": [
        "-m", "ruff", "format", "${workspaceFolder}\\injector"
      ],
      "group": "build",
      "presentation": {
        "echo": true,
        "reveal": "silent",
        "focus": false,
        "panel": "shared"
      },
      "detail": "Format Python code using Ruff"
    },
    {
      "label": "Lint Python Code",
      "type": "shell",
      "command": "${workspaceFolder}\\.venv\\Scripts\\python.exe",
      "args": [
        "-m", "ruff", "check", "${workspaceFolder}\\injector"
      ],
      "group": "test",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared"
      },
      "problemMatcher": {
        "owner": "ruff",
        "fileLocation": ["relative", "${workspaceFolder}"],
        "pattern": {
          "regexp": "^(.+?):(\\d+):(\\d+):\\s+(\\w+):\\s+(.+)$",
          "file": 1,
          "line": 2,
          "column": 3,
          "severity": 4,
          "message": 5
        }
      },
      "detail": "Lint Python code using Ruff"
    },

    // ────────── Test Tasks ──────────
    {
      "label": "Run All Tests",
      "type": "shell",
      "command": "powershell.exe",
      "args": [
        "-ExecutionPolicy", "Bypass",
        "-File", "${workspaceFolder}\\tests\\run-tests.ps1",
        "-TestSuite", "all",
        "-Verbose"
      ],
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "new"
      },
      "dependsOn": "Build All",
      "detail": "Run comprehensive test suite (builds project first)"
    },
    {
      "label": "Run Tests (Safe Mode)",
      "type": "shell",
      "command": "powershell.exe",
      "args": [
        "-ExecutionPolicy", "Bypass",
        "-File", "${workspaceFolder}\\tests\\run-tests.ps1",
        "-TestSuite", "all",
        "-SafeMode",
        "-Verbose"
      ],
      "group": "test",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "new"
      },
      "dependsOn": "Build All",
      "detail": "Run tests without dangerous injection attempts"
    },
    {
      "label": "Test DLL Build",
      "type": "shell",
      "command": "powershell.exe",
      "args": [
        "-ExecutionPolicy", "Bypass",
        "-File", "${workspaceFolder}\\tests\\test-dll-build.ps1",
        "-Verbose"
      ],
      "group": "test",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared"
      },
      "detail": "Test C++ DLL build process and output"
    },
    {
      "label": "Test Environment Setup",
      "type": "shell",
      "command": "powershell.exe",
      "args": [
        "-ExecutionPolicy", "Bypass",
        "-File", "${workspaceFolder}\\tests\\test-env-setup.ps1",
        "-Verbose",
        "-FixIssues"
      ],
      "group": "test",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared"
      },
      "detail": "Test and fix Python environment setup"
    },
    {
      "label": "Test Injector",
      "type": "shell",
      "command": "powershell.exe",
      "args": [
        "-ExecutionPolicy", "Bypass",
        "-File", "${workspaceFolder}\\tests\\test-injector.ps1",
        "-SafeMode",
        "-Verbose"
      ],
      "group": "test",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared"
      },
      "detail": "Test injector functionality (safe mode)"
    }
  ]
}
